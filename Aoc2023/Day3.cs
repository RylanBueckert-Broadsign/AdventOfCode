using AoC2023.Common;

namespace AoC2023;

public static class Day3
{
    public static void Part1()
    {
        const string input = "........936..672.........846.922........359...332......582..856........................579..93......674..740.....243.156....................\n...........%.........4=...*...*........*.......*......#....................806..481.........................*.......*.........900......$564.\n.............520........624.965....143..405.....960.............273...651...*....*.........554....139@.....38...*.........58..*...392.......\n................$....................*.........................*.....&......634.3..../.................-......310....*313.*.........*.......\n...196....544......541................775.216...+557..225/..463.......................517..........960.228........452.....593.......772.....\n.....*....*...654.*........638............*...........................163....................386#......................20......169..........\n.....566..20...$...132........*969......747........*971..342............=.245*.......................277.522............*..............+....\n.............+..............................205.716...........................855.............324......................871..752.........291.\n.........47..390.......128...%....528........%..........91*192.......=.....................=.#.............%..852*156......+................\n.....975..*.......=....*...322.......#............&63.............946...................462....939..520...268............#.....*....380.....\n.........55..=.....871..68.............................................491.......................*.....*............674.770.333.415...*.275.\n..............633...........@.....642.5........+.......739........632.....*.......992.74.615...858...998.............*..............761.*...\n....446......................180./..../........83...&.....*924....&........379...*......................................................118.\n...........488*240.......150......................958..........$.....&...........964...351...........+..633.........123....../603...........\n...................987....../........546-...674...............466.....602.............@...........956..#............./......................\n......503=....465.................91.........*..........................................583..............128..124..........$.....217........\n..............*...32$..53....&594.........648...827....*..994.......971...................*..........304...%....*.......387..80.............\n............756.......#..........................*..888...$............@....339.......+..868........*........851..............*.........128.\n...905-.........312..................729...356*.697.........736.....+.......+.......748.......797....41....................272..753.........\n.................*....&604............*.............%915.......*.529..889...................*.........................992.........*.....718.\n...........272....487..............+...961.892..............632........*.................502.118....141................@......546.669.......\n787..........*....................85............/..330...........-...374.............................*.........446...%.........*............\n....-...../...120....919&.....................339....*....*663...403........167...533.170.............698..587...*....279.......776.+.......\n.575.....34.*.................668...19..759.......804..730...../.............*...........*.....789...........*....803......666.......25.....\n............375...773*.............*.........................$.876...287......201........484......*.........196.............................\n565...866.............23..477...455....................794.996.........*.....................887.959...146...........496....790.............\n..............648...........+........325.738....156.....*.........534..941.....%536..31..../.%...........*............*.....*.......511.....\n..............*.................166.....*......*.....647..........*......................262...........887..210.3..860.....161....4....*420.\n......141.606...........193.111..*..........252......................935*689..................500...........*...*.................*.........\n..635....*........=........*.....959.....................@834.................-.....542..547....-..........770.8...........439..............\n.................896.........93......................244..........@......247..735..*.................................497.............%......\n...............................%........................*..........200....+.......342.613.245.@............$.........#....*.......176...21..\n......51......702.37.......798....325.....&974.....834.860.....+.........................*.....533..866....864.............269..............\n..141..*......................-...&............875*.............207...882*.........................*............309.739........%......../...\n.......394....144.....................................$...................835.3..........290.......489...........&.....*177.833....866$.153.\n.689.................719.314/..$......673.....5*557...443......+..#649.............575....*..634*...........................................\n....&...........794...*........614...*......................350.............411......*.104.......141........369...934...........997.........\n.......519......*...787..............739.....628...................................784.......$..........989*........*...987.......*....#....\n.........*...309.........209.............957*........50.....@995...765.......269.@........380..624.................643.....*....836...356...\n......886............234.+....................51*935..*...........*.....188.......73..............*696...14.....#...........................\n............203..948...&...............................957......804.736*......388....689.219*660........*.....218....................$..40..\n..............*.....*.....475.....930..........%................................*......*..............477.624................848...687......\n....57*.50.229....636....*.................804.164....590.........-....547..80..310....675.......=.@...........................*............\n........................398......&........*..............*.....748...........*................226..200................160......853..........\n......292........................889.......867.....365...............192+..530.........................@910....=..222*.............894......\n..427....#.../...959........................................322.....................735*304....742..........195..........$..............22..\n...........465..-.........52.$......168.......418.......+.........................................$..............&......563...649*26........\n....................464..../.969....*......-..*........150......724.....83..301...............527...............858.506.....................\n...935.........910....+...........116....427...347.............-........*.....=.......891.......*....847...750........@................531..\n....*.........$.........676...............................510............11.......647.*.................#.....%.683.............193...+.....\n....761.169...............=...524........&......152..........*...975.994.........*....122..........858*...........%.......776...........*...\n...........-..180/.850..............$.....524....-...........940.=......*......199........963..............#........836...*.....34...543.448\n482...947...................94&....541..............265..............477..890..............*....988.....343..........&...599....+...........\n.......*...532..81..73..417............992/...99&...#........................*.33@.149..305.........678.....31.........@.................417\n....304.....@.....*...#../....452.842.................519.....307.949.....268................=.........*....*...........259.................\n..................361............*.......346............*.+......*...........................288.......492..985.............727.683.........\n....530....438..........950..........*......*........787..316...............762.724.257..889.....................844.......*......=....@125.\n..............*...446...*......879..827......148......................*730.......@..........*...832...............*.......647.......48......\n....500.......994........41.......*.....#805...........*...........614...............*....940................291&.129.8............=........\n....*...#..........698..........581.................940.462.....@......443...82.784.593......../.#375..%148............*..#.................\n.....39.562...784............................................805...$......@...*..*..........844.....................776....363...667........\n................%...265.......337.....438...295.....................499......341.74..................271.405.......................%.155....\n.........97..........*......@....*252.*......*....+.........270.229.................394...879*247.....*...*.....146.....................*...\n........%.............226..258........996.944......793........*.../...................+..............321.578.....$..........838.....529.831.\n.................%109.........................................615....822.....................501.............616....293.....&........-......\n.......%....482...........................%717.236.......562...........*...........915...580....*............*.....+..........230...........\n.....303.......*128..86&......762.928.............$........*......861*.311........*....../....517..........471.544.....996.......*38...628..\n...........563............89.*......*.583...%.148.......$.987...................35..................996...........=....*...............*....\n......776.....+...........*......967...@..168...*.....772.........838*.....480..............................-........976..............530...\n................649*32...84.#...................315...................37............398.656...631..........340.985*..........522............\n............................922........................./.173....894................*.........$....................177.......#..............\n......................................................423....*....*.....816.........13.................=..............................251...\n..154...................878*......................568......723..329....&......928.................-71.123.378..100...................*......\n........*21..250............448.734.718.....&....*......................................599...............%....*.....700+.....*803..401.....\n.779.550........*.817............./..*....118....980..589.....235......=....539...........*...281*236..........591.........927..........*...\n...-.................*...............854.............*.................911.=............939........................616..*............770.50.\n.............82......399.......452..................184........643..........................*871..................*....370..................\n.185.405.....*...634............*......189.838.................*...............@623......252...........315.86.....568...........157.104.....\n...&......586.......*........957..........*.......841.........509.600........................896..565.....*...............+............*....\n..................633.628...........811..........*.....677.........-..580..751...183.........................540.81.......656..665..634.....\n......112.............*.....=........./.322...430.........*..........+.....*...............683............$.....*...........................\n830&...*..426........649..910...........*................717..359........831........=..157..%.............143......758................579...\n.....373....*..................215.......666....................*.#...........459..547...+.........773.........980*.........404...126.......\n205......636....................*...420.......440..........225.11.516...568....*......................*....474........620...*.....*.........\n..............250......685...209.....+...........*257.................../...407.......295..498....122.............970...@.392.412...........\n783..83+...........706....=.................330*............833.................*250....%..=..........%...........*............#....898.....\n...........$....................................398..35........*......646....759.....#.............527..........160.....254.................\n500........777...........112..428...663....957#..............524.....*..../........249..530*672............567......*......*759.....284*....\n....861....................*.*......*............*...277*832.....644.130..216.446............................*...683.955................950.\n....*........826..........68.535..192.........306..................#..................762%...%....#631..500.406..........763...137..........\n..65............-...499=..................546.....&.........$........../..........177........988.......@.............336...*..*.............\n.....362..................@...$..........-....610..65......64.........830..........-...........................452......+.604.542...........\n........*902.633*........873..63.....781...31...*.................258.....12...681..........18*........&...&............................848.\n..803............752.........................-.....672...................*.............................470..86.59.......%...................\n.......@..547..........$...184.......320..........+..........471......834...=...551..108.............................176.................82.\n..950.562............261...$.....754..+..............134.654*...............778..&......%..713.837.......................329........186.....\n............112..72...............*..........917......*.................415............................946....=....614.....*................\n..............*.$......850.....766.....308.....*....666................*......812.....293................*.624.......%..296.....612...333...\n..996......154...........................*......283.....*.555.%........................-.......552.714.563.......227..............-.........\n....*.682.................=.......281.217..............84.*....908.....@...=....522..............$.*.......630......*79..............556....\n..635...*............516...402............................333........114..496..*.......324..........522.....................................\n.........511....779...*............@............350.853.........................791...................................$.....821.....+.......\n.................*.....486........984......332.....*..............893..730*480...................756...................776...........155....\n......161......57..590....................@....398..................*....................477.....*......602....506............996...........\n.151.....*..=.......*......955.......916........#.....=..269.........423..........289......*..379...*..@.....................*..............\n...-....123..927.600...........-........*395........226./....676*755...........30..........58.....582.........671.118..43.367...943......478\n.....................725........74...............................................+...........................-......*..*................&...\n........378......563*.....*999............*...................497.349...26.....$............362.........&........723....20....717...317.....\n...*....................22.........../.575.552..........291......*..........600......152.../......./...169......................-.@....*977.\n886.250..........$.............383.603.............36*.../....%......................*.............253........215..........139....583.......\n................225............................................721...814..............829..................*.......613*544.*...=........901.\n..........741.......595.........785.............%677..50................=.................252......710....91...............912.180..........\n...........*...................*....808...956..........+.....812...............*381......*.....676.../..........599....................+....\n............134.184......759..81...*.........*.782........41*......=....125.216........679...../..........@........*.................567....\n.......165.........*......@................66...*.....*.........379.....................................&..626...241........................\n.........*.........232.........387.86...........635.47.806.857.........$537...............240........617..............806..941..........531.\n.......687...654.......735......*...$......................%.....357..............*884.......*571..........273.551......*.....*....576..*...\n............*................648...................716.304..........*...690....663.................*38...........*....365......911....@..424\n....67*156...250..828...................&222.......#...*......16....300.+..................-....-.9....813...982..443.......................\n.....................*......136..757..................65..314...*........................615.291.......&....*................972............\n................721..592...@.............................../...808.............665...176.............................200.....*..............\n..198..459+............................218........-772..............169...39..*........*........939..742......#....=......532...#..264......\n.....*...............$..........713...*............................*.....*...831....689...589*.......*.......91....75.........641...#.......\n..896..167*........372...138...........462...*227..$.....801......512.........................775.673.......................................\n...............47........*.......135...............725.....*...............743..........489*.............735..622.815.551...........519.....\n.......=........*......636.987...*...................................827........496*........48.121................*.....*........#.....*311.\n....525.......819.580.........#.369......119...............77.........*...............10*........*.%.....975.....961....888......304........\n........................96*..........................816............857......=...........376...859.522..=...................................\n629...419..259...#360.......44%.........190..=969...........=...539.....-913.429......................................119.....476...707.....\n...*.....*...*....................*906.*.....................84.....286...............$...=...127.200.465........324.............=.....*599.\n905.....762...262.....-597.....847......311......@654...837............*....455..37..439..147....*.....*...262...*.....787..778.............\n...........................25...........................=...........908....*.......*................827......%....567....-....#.427..819....\n..............................#.$....643=...............................886......243....../.....672..............................*....*.....\n...........185*....107.....226..965........$.................756........................808.221...-.../574...541&...+....871...326....349...\n......................*.....................841.....=...........*688........177................*....................166....*................\n.......189..744......308.......99*391..630/........463......................@...930..........543..........................519...............\n..984.%........-.741.......................................522.915+.....769......*................207....976.....158*.......................\n....*...............*...............&.331...787........48...........224..*......184........874.......=.....*........................537.....\n.....934....*339...829....495.....682...*.............*....+..........*..794..........-430...*....&........848..367....+............*....505\n.........175..........................381............270....198......911...................52......642...............45............445......";
        var lines = input.Split("\n");

        var width = lines.First().Length;
        var height = lines.Length;

        var nums = new List<int>();

        for (var row = 0; row < height; row++)
        {
            for (var col = 0; col < width; col++)
            {
                if (char.IsDigit(lines[row][col]))
                {
                    var start = col;
                    do
                    {
                        col++;
                    } while (col < width && char.IsDigit(lines[row][col]));

                    var end = col - 1;

                    if (IsNearSymbol(lines, row, start, end))
                    {
                        nums.Add(int.Parse(lines[row][start..(end + 1)]));
                    }
                }
            }
        }

        Console.WriteLine(nums.Sum());
    }

    public static void Part2()
    {
        const string input = "........936..672.........846.922........359...332......582..856........................579..93......674..740.....243.156....................\n...........%.........4=...*...*........*.......*......#....................806..481.........................*.......*.........900......$564.\n.............520........624.965....143..405.....960.............273...651...*....*.........554....139@.....38...*.........58..*...392.......\n................$....................*.........................*.....&......634.3..../.................-......310....*313.*.........*.......\n...196....544......541................775.216...+557..225/..463.......................517..........960.228........452.....593.......772.....\n.....*....*...654.*........638............*...........................163....................386#......................20......169..........\n.....566..20...$...132........*969......747........*971..342............=.245*.......................277.522............*..............+....\n.............+..............................205.716...........................855.............324......................871..752.........291.\n.........47..390.......128...%....528........%..........91*192.......=.....................=.#.............%..852*156......+................\n.....975..*.......=....*...322.......#............&63.............946...................462....939..520...268............#.....*....380.....\n.........55..=.....871..68.............................................491.......................*.....*............674.770.333.415...*.275.\n..............633...........@.....642.5........+.......739........632.....*.......992.74.615...858...998.............*..............761.*...\n....446......................180./..../........83...&.....*924....&........379...*......................................................118.\n...........488*240.......150......................958..........$.....&...........964...351...........+..633.........123....../603...........\n...................987....../........546-...674...............466.....602.............@...........956..#............./......................\n......503=....465.................91.........*..........................................583..............128..124..........$.....217........\n..............*...32$..53....&594.........648...827....*..994.......971...................*..........304...%....*.......387..80.............\n............756.......#..........................*..888...$............@....339.......+..868........*........851..............*.........128.\n...905-.........312..................729...356*.697.........736.....+.......+.......748.......797....41....................272..753.........\n.................*....&604............*.............%915.......*.529..889...................*.........................992.........*.....718.\n...........272....487..............+...961.892..............632........*.................502.118....141................@......546.669.......\n787..........*....................85............/..330...........-...374.............................*.........446...%.........*............\n....-...../...120....919&.....................339....*....*663...403........167...533.170.............698..587...*....279.......776.+.......\n.575.....34.*.................668...19..759.......804..730...../.............*...........*.....789...........*....803......666.......25.....\n............375...773*.............*.........................$.876...287......201........484......*.........196.............................\n565...866.............23..477...455....................794.996.........*.....................887.959...146...........496....790.............\n..............648...........+........325.738....156.....*.........534..941.....%536..31..../.%...........*............*.....*.......511.....\n..............*.................166.....*......*.....647..........*......................262...........887..210.3..860.....161....4....*420.\n......141.606...........193.111..*..........252......................935*689..................500...........*...*.................*.........\n..635....*........=........*.....959.....................@834.................-.....542..547....-..........770.8...........439..............\n.................896.........93......................244..........@......247..735..*.................................497.............%......\n...............................%........................*..........200....+.......342.613.245.@............$.........#....*.......176...21..\n......51......702.37.......798....325.....&974.....834.860.....+.........................*.....533..866....864.............269..............\n..141..*......................-...&............875*.............207...882*.........................*............309.739........%......../...\n.......394....144.....................................$...................835.3..........290.......489...........&.....*177.833....866$.153.\n.689.................719.314/..$......673.....5*557...443......+..#649.............575....*..634*...........................................\n....&...........794...*........614...*......................350.............411......*.104.......141........369...934...........997.........\n.......519......*...787..............739.....628...................................784.......$..........989*........*...987.......*....#....\n.........*...309.........209.............957*........50.....@995...765.......269.@........380..624.................643.....*....836...356...\n......886............234.+....................51*935..*...........*.....188.......73..............*696...14.....#...........................\n............203..948...&...............................957......804.736*......388....689.219*660........*.....218....................$..40..\n..............*.....*.....475.....930..........%................................*......*..............477.624................848...687......\n....57*.50.229....636....*.................804.164....590.........-....547..80..310....675.......=.@...........................*............\n........................398......&........*..............*.....748...........*................226..200................160......853..........\n......292........................889.......867.....365...............192+..530.........................@910....=..222*.............894......\n..427....#.../...959........................................322.....................735*304....742..........195..........$..............22..\n...........465..-.........52.$......168.......418.......+.........................................$..............&......563...649*26........\n....................464..../.969....*......-..*........150......724.....83..301...............527...............858.506.....................\n...935.........910....+...........116....427...347.............-........*.....=.......891.......*....847...750........@................531..\n....*.........$.........676...............................510............11.......647.*.................#.....%.683.............193...+.....\n....761.169...............=...524........&......152..........*...975.994.........*....122..........858*...........%.......776...........*...\n...........-..180/.850..............$.....524....-...........940.=......*......199........963..............#........836...*.....34...543.448\n482...947...................94&....541..............265..............477..890..............*....988.....343..........&...599....+...........\n.......*...532..81..73..417............992/...99&...#........................*.33@.149..305.........678.....31.........@.................417\n....304.....@.....*...#../....452.842.................519.....307.949.....268................=.........*....*...........259.................\n..................361............*.......346............*.+......*...........................288.......492..985.............727.683.........\n....530....438..........950..........*......*........787..316...............762.724.257..889.....................844.......*......=....@125.\n..............*...446...*......879..827......148......................*730.......@..........*...832...............*.......647.......48......\n....500.......994........41.......*.....#805...........*...........614...............*....940................291&.129.8............=........\n....*...#..........698..........581.................940.462.....@......443...82.784.593......../.#375..%148............*..#.................\n.....39.562...784............................................805...$......@...*..*..........844.....................776....363...667........\n................%...265.......337.....438...295.....................499......341.74..................271.405.......................%.155....\n.........97..........*......@....*252.*......*....+.........270.229.................394...879*247.....*...*.....146.....................*...\n........%.............226..258........996.944......793........*.../...................+..............321.578.....$..........838.....529.831.\n.................%109.........................................615....822.....................501.............616....293.....&........-......\n.......%....482...........................%717.236.......562...........*...........915...580....*............*.....+..........230...........\n.....303.......*128..86&......762.928.............$........*......861*.311........*....../....517..........471.544.....996.......*38...628..\n...........563............89.*......*.583...%.148.......$.987...................35..................996...........=....*...............*....\n......776.....+...........*......967...@..168...*.....772.........838*.....480..............................-........976..............530...\n................649*32...84.#...................315...................37............398.656...631..........340.985*..........522............\n............................922........................./.173....894................*.........$....................177.......#..............\n......................................................423....*....*.....816.........13.................=..............................251...\n..154...................878*......................568......723..329....&......928.................-71.123.378..100...................*......\n........*21..250............448.734.718.....&....*......................................599...............%....*.....700+.....*803..401.....\n.779.550........*.817............./..*....118....980..589.....235......=....539...........*...281*236..........591.........927..........*...\n...-.................*...............854.............*.................911.=............939........................616..*............770.50.\n.............82......399.......452..................184........643..........................*871..................*....370..................\n.185.405.....*...634............*......189.838.................*...............@623......252...........315.86.....568...........157.104.....\n...&......586.......*........957..........*.......841.........509.600........................896..565.....*...............+............*....\n..................633.628...........811..........*.....677.........-..580..751...183.........................540.81.......656..665..634.....\n......112.............*.....=........./.322...430.........*..........+.....*...............683............$.....*...........................\n830&...*..426........649..910...........*................717..359........831........=..157..%.............143......758................579...\n.....373....*..................215.......666....................*.#...........459..547...+.........773.........980*.........404...126.......\n205......636....................*...420.......440..........225.11.516...568....*......................*....474........620...*.....*.........\n..............250......685...209.....+...........*257.................../...407.......295..498....122.............970...@.392.412...........\n783..83+...........706....=.................330*............833.................*250....%..=..........%...........*............#....898.....\n...........$....................................398..35........*......646....759.....#.............527..........160.....254.................\n500........777...........112..428...663....957#..............524.....*..../........249..530*672............567......*......*759.....284*....\n....861....................*.*......*............*...277*832.....644.130..216.446............................*...683.955................950.\n....*........826..........68.535..192.........306..................#..................762%...%....#631..500.406..........763...137..........\n..65............-...499=..................546.....&.........$........../..........177........988.......@.............336...*..*.............\n.....362..................@...$..........-....610..65......64.........830..........-...........................452......+.604.542...........\n........*902.633*........873..63.....781...31...*.................258.....12...681..........18*........&...&............................848.\n..803............752.........................-.....672...................*.............................470..86.59.......%...................\n.......@..547..........$...184.......320..........+..........471......834...=...551..108.............................176.................82.\n..950.562............261...$.....754..+..............134.654*...............778..&......%..713.837.......................329........186.....\n............112..72...............*..........917......*.................415............................946....=....614.....*................\n..............*.$......850.....766.....308.....*....666................*......812.....293................*.624.......%..296.....612...333...\n..996......154...........................*......283.....*.555.%........................-.......552.714.563.......227..............-.........\n....*.682.................=.......281.217..............84.*....908.....@...=....522..............$.*.......630......*79..............556....\n..635...*............516...402............................333........114..496..*.......324..........522.....................................\n.........511....779...*............@............350.853.........................791...................................$.....821.....+.......\n.................*.....486........984......332.....*..............893..730*480...................756...................776...........155....\n......161......57..590....................@....398..................*....................477.....*......602....506............996...........\n.151.....*..=.......*......955.......916........#.....=..269.........423..........289......*..379...*..@.....................*..............\n...-....123..927.600...........-........*395........226./....676*755...........30..........58.....582.........671.118..43.367...943......478\n.....................725........74...............................................+...........................-......*..*................&...\n........378......563*.....*999............*...................497.349...26.....$............362.........&........723....20....717...317.....\n...*....................22.........../.575.552..........291......*..........600......152.../......./...169......................-.@....*977.\n886.250..........$.............383.603.............36*.../....%......................*.............253........215..........139....583.......\n................225............................................721...814..............829..................*.......613*544.*...=........901.\n..........741.......595.........785.............%677..50................=.................252......710....91...............912.180..........\n...........*...................*....808...956..........+.....812...............*381......*.....676.../..........599....................+....\n............134.184......759..81...*.........*.782........41*......=....125.216........679...../..........@........*.................567....\n.......165.........*......@................66...*.....*.........379.....................................&..626...241........................\n.........*.........232.........387.86...........635.47.806.857.........$537...............240........617..............806..941..........531.\n.......687...654.......735......*...$......................%.....357..............*884.......*571..........273.551......*.....*....576..*...\n............*................648...................716.304..........*...690....663.................*38...........*....365......911....@..424\n....67*156...250..828...................&222.......#...*......16....300.+..................-....-.9....813...982..443.......................\n.....................*......136..757..................65..314...*........................615.291.......&....*................972............\n................721..592...@.............................../...808.............665...176.............................200.....*..............\n..198..459+............................218........-772..............169...39..*........*........939..742......#....=......532...#..264......\n.....*...............$..........713...*............................*.....*...831....689...589*.......*.......91....75.........641...#.......\n..896..167*........372...138...........462...*227..$.....801......512.........................775.673.......................................\n...............47........*.......135...............725.....*...............743..........489*.............735..622.815.551...........519.....\n.......=........*......636.987...*...................................827........496*........48.121................*.....*........#.....*311.\n....525.......819.580.........#.369......119...............77.........*...............10*........*.%.....975.....961....888......304........\n........................96*..........................816............857......=...........376...859.522..=...................................\n629...419..259...#360.......44%.........190..=969...........=...539.....-913.429......................................119.....476...707.....\n...*.....*...*....................*906.*.....................84.....286...............$...=...127.200.465........324.............=.....*599.\n905.....762...262.....-597.....847......311......@654...837............*....455..37..439..147....*.....*...262...*.....787..778.............\n...........................25...........................=...........908....*.......*................827......%....567....-....#.427..819....\n..............................#.$....643=...............................886......243....../.....672..............................*....*.....\n...........185*....107.....226..965........$.................756........................808.221...-.../574...541&...+....871...326....349...\n......................*.....................841.....=...........*688........177................*....................166....*................\n.......189..744......308.......99*391..630/........463......................@...930..........543..........................519...............\n..984.%........-.741.......................................522.915+.....769......*................207....976.....158*.......................\n....*...............*...............&.331...787........48...........224..*......184........874.......=.....*........................537.....\n.....934....*339...829....495.....682...*.............*....+..........*..794..........-430...*....&........848..367....+............*....505\n.........175..........................381............270....198......911...................52......642...............45............445......";
        var lines = input.Split("\n");

        var width = lines.First().Length;
        var height = lines.Length;

        var gearCoords = new List<Coords2D>();

        for (var row = 0; row < height; row++)
        {
            for (var col = 0; col < width; col++)
            {
                if (lines[row][col] == '*')
                {
                    gearCoords.Add((row, col));
                }
            }
        }

        var nums = gearCoords.Select(coord => GetSurrounding(lines, coord.Row, coord.Col).Distinct().ToList()).Where(surr => surr.Count == 2).Select(surr => surr[0] * surr[1]).ToList();

        Console.WriteLine(nums.Sum());
    }

    private static bool IsNearSymbol(string[] input, int row, int startCol, int endCol)
    {
        var width = input.First().Length;
        var height = input.Length;

        //Check above
        if (row > 0 && input[row - 1][(Math.Max(startCol - 1, 0))..(Math.Min(endCol + 2, width))].Any(IsSymbol))
        {
            return true;
        }

        //Check below
        if (row < height - 1 && input[row + 1][(Math.Max(startCol - 1, 0))..(Math.Min(endCol + 2, width))].Any(IsSymbol))
        {
            return true;
        }

        //check sides
        if (startCol > 0 && IsSymbol(input[row][startCol - 1]))
        {
            return true;
        }

        if (endCol < width - 1 && IsSymbol(input[row][endCol + 1]))
        {
            return true;
        }

        return false;
    }

    private static bool IsSymbol(char ch) =>
        !char.IsDigit(ch) && ch != '.';

    private static List<int> GetSurrounding(string[] input, int row, int col)
    {
        var width = input.First().Length;
        var height = input.Length;

        var result = new List<int>();

        for (var i = row - 1; i <= row + 1; i++)
        {
            for (var j = col - 1; j <= col + 1; j++)
            {
                if (i >= 0 && i < height && j >= 0 && j < width && char.IsDigit(input[i][j]))
                {
                    result.Add(GetNumber(input[i], j));
                }
            }
        }

        return result;
    }

    private static int GetNumber(string line, int idx)
    {
        var start = idx;
        var end = idx + 1;

        while (start > 0 && char.IsDigit(line[start - 1]))
        {
            start--;
        }

        while (end < line.Length && char.IsDigit(line[end]))
        {
            end++;
        }

        return int.Parse(line[start..end]);
    }
}
